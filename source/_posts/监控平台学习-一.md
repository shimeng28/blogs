---
title: 监控平台学习(一) 埋点
date: 2018-10-27 13:59:11
tags:  前端监控
---
当第一次看到这个问题，最熟悉的应该是在开发中遇到的埋点，每次PM给一个需求时，最后都会有埋点的任务，我们会把要监控的页面所代表的值，以及一些额外的数据放到上报函数里面，将数据上报上去，之后在监控平台验证，没问题的话这部分的工作量就完成了。那么当需要从零开始实现一个监控系统的时候，又需要考虑哪些问题呢？

遇到这个问题的时候，首先在脑袋里应该先过一遍的是自己会如何实现，对我来说，可能就是开发一个SDK，用户想要埋点的时候把数据通过HTTP请求发送到服务器，之后服务器把数据存储，再之后就是数据的分析。这是大的概论。那如果想要更进一步，不需要手动调用代码，我们在后面默默的把事情做了，那又应该怎么做呢？这个思路可能就是，把需要上报的全部定义好，事件触发的时候上报数据。可是业务需求千变万化，没有办法把所有的问题都穷举，所以干脆把所有的数据全部上报，这也就是无埋点了，无埋点不是不埋点，是全部埋点。

监控分为：行为数据的监控，性能的监控以及异常的监控。数据行为的监控包含PV(page view)和 UV(user view)；用户的来源渠道；用户在页面中停留的时间以及用户的操作。性能的监控就包含接口的请求响应时间，不同用户，不同机型，系统的首页加载时间，白屏时间，静态资源的下载时间，页面的渲染时间，页面中动画的交互时间。对于异常监控就包含JavaScript的异常以及样式的异常。

针对监控的内容有三种埋点方式，一种是代码埋点，就是在事件的监听函数内调用上报方法，发送相关数据。它的优点就是我们可以精确的控制埋点的时机以及想要上报的数据，缺点就是每一处都需要埋点，如果业务升级，原先的不合适埋点就需要重新做。第二种就是无埋点，无埋点就是全埋点，标记页面上中所有的元素，监听页面的事件，在事件触发时上报数据，无埋点的优点很明显，我们可以监控所有的数据，并且可以回溯之前的原数据，相应的缺点也很明显，没法定制自己的埋点，只能使用在SDK初始设置的埋点。第三种埋点就是可视化埋点，使用者引入SDK， 从可视化埋点管理后台进入使用者的页面， 使用者点击任意元素， SDK取得该元素的URL和层级关系来描述这个元素，使用者设置这个元素和某个事件相关联，SDK把这些信息生成配置信息，当普通用户访问时，SDK自动加载配置信息，当元素被点击时，发送数据追踪事件

具体的实现先看下mixPanel，作为一个开源的监控系统，需要先学习读一读它的源代码。那么就作为下次文章的内容了。

