---
title: 自己写一个日历组件
date: 2018-02-09 19:20:58
tags:
---
问题背景
票房项目=> 影人详情页 => 邀他合作 页面中 日历选择组件是native组件，只能在APP中使用。为了在浏览器中使用日历组件，需要开发一个日历组件。

问题参考页面：https://piaofang.maoyan.com/connect/send-invitation

调研
(一）https://github.com/ddd702/datePicker/blob/master/js/datePicker.js

这个组件是基于zepto的日历组件，样式与我们想要的十分相像，可以作为参考。



 

(二）https://github.com/xingchou/datePicker

这个组件是原生JS实现的日历组件，样式也差不多，主要的问题是在选择滚动日历的时候不太流畅，这点需要解决。



 

(三)  https://github.com/sentsin/laydate/

layDate 是 layui 独立维护的三大组件之一，样式结构和我们所要的不一样，如果借用的话需要修改比较多的地方



设计实现：
为了与票房专业版APP内UI类似，选择第二种组件的结构。组件的主体，即选择年份，月份，日期的三个部分分别为一个scroller, 当用户滑动不同的部分，则根据用户滑动的距离滚动响应的距离。

为了实现滚动到选择区域高亮显示，其他部分增加不透明度。一种方案是在非选中区域增加一个遮罩层，由于有三个scroller，因此这种方案要增加六个遮罩层，这部分遮罩层会遮挡滚动区域，需要在遮罩层上监听事件。第二种方案是，将所有字体颜色设置不透明度，当滚动到选择区域时，高亮显示字体，不过这种方案有一个问题，也就是滚动经过选择区域并不会高亮字体，只会高亮最后滚动到选择区域的元素，体验不是很逼真。暂时选择了第二种方案。

当添加多个日期组件时，每个组件之间会造成选择元素的混乱，解决方案是针对每一个日期组件赋给它一个不同的后缀，每个日期组件外层div增加ID，将后缀添加到ID的最后，防止和用户的页面中的ID冲突。

应为组件的滚动距离是基于每个日期的高度决定的，因此当我们将整个组件隐藏的时候生成一个实例的话，每个日期元素的高度为0，则发生错误，因此解决方案是不使用display：none，而是决定使用z-index（正好整个组件使用了position: fixed，所以可以实现该效果）。

[最终项目地址](https://github.com/shimeng28/datePicker)

后续优化：

一方面动画效果不佳，这个需要后续的优化。另一个方面是透明度的显示方面，可以改变为增加遮罩层来实现

 

感想：

完成一个实现了功能的组件并不是最难的地方，最难的是将它优化到极致。